# counter-example_based_SAG
The final version
# Find a counterexample in SAG

This repository contains the implementations of finding an example of an execution scenario in which timing requirements are violated when SAG deems a system unschedulable. we optimize the process by dividing it in three steps.
Each step executes a different algorithm. They manipulate and compute different data. At the
end of the third step, a scheduling example that leads to a deadline miss is then produced.

## First step algorithem
To run the tool on a given set for the first step, just pass the filename as an argument. The config file for ***//#define CONFIG_COUNTER_EXAMPLE*** should stay as comment out describe as below:

> #ifndef CONFIG_H
> #define CONFIG_H
> #ifndef NDEBUG
> #define TBB_USE_DEBUG 1
> #endif
> //#define CONFIG_COUNTER_EXAMPLE
> #endif

For running the program, the example input is:
```sh
./nptest  --counter-example first-run  examples/U0.7_T9_Run6.csv
```
If the given set is schedulable. No further output will produce. Otherwise a csv file with a *.rj* is generated and this file is the input for our second-step algorithm.

## Second step algorithm
Before running the second step algorithm, we already know the given job set is unschedulable. The config file stays the same as in the first step. To run this unschedulable job set file *.rj.csv*, for instance, we can use the following command:
```sh
./nptest  --counter-example second-run  examples/U0.7_T9_Run6.rj.csv. 
```
By end of this step, the compressed SAG is generated which contains a concrete execution scenario in which a job Ji misses its deadline. This compressed SAG is written as a csv file e.g., U0.8_T6_Run47.rj.pop.csv.


## Third step algorithm
To run the third step algorithm, we should first change the config file to ***#define CONFIG_COUNTER_EXAMPLE***. 
> #ifndef CONFIG_H
> #define CONFIG_H
> #ifndef NDEBUG
> #define TBB_USE_DEBUG 1
> #endif
> #define CONFIG_COUNTER_EXAMPLE
> #endif

Later, we need not only to give the reduced job set generated by the end of the first step, but we also need the compressed SAG produced by the second step. Therefore, to run the third step algorithm, our input can be 
```sh
./nptest  examples/U0.6_T15_Run3.rj.csv -b  examples/U0.6_T15_Run3.rj.pop.csv.
```
By the end of the third step, the conterexample execution senario is save as ***.rj.ce.csv*** csv file .

# Output Format
The output for the **first step** is illustrated below
```sh
examples/mer-example.csv,  0,  9,  20,  29,  3,  0.002188,  1.441406,  0,  1
```

1. The input file name. For the first step only one input file is required.
2.  The schedulability result:
    -  if the job is is schedulable (i.e., the tool could prove the absence of deadline misses) therefore no extra file will generate, the progress can stop here.
    - 0 if it is not, or if the analysis cannot prove the absence of deadline misses. The .rj csv file is generated by the end of this step.
3. The number of jobs in the job set.
4. The number of states that were explored.
5. The number of edges that were discovered.
6. The maximum “exploration front width” of the schedule graph, which is the maximum number of unprocessed states that are queued for exploration (at any point in time).
7. The CPU time used in the analysis (in seconds).
8. The peak amount of memory used (as reported by getrusage()), divided by 1024. Due to non-portable differences in getrusage(), on Linux this reports the memory usage in megabytes, whereas on macOS it reports the memory usage in kilobytes.
9. A timeout indicator: 1 if the state-space exploration was aborted due to reaching the time limit (as set with the -l option); 0 otherwise.
10. The number of processors assumed during the analysis.

The output for the **second step**  and  **third step** is similar to the first step:
```sh
examples/mer-example.rj.csv,  0,  9,  19,  28,  3,  0.000532,  3.730469,  0,  1
```
The file name ends with ***.rj.csv***  and this reduced job set is alwasy not schedulable. The output for the third step is depicted as:
```sh
examples/mer-example.rj.csv,  0,  9,  8,  7,  3,  0.000034,  3.613281,  0,  1
```

## Counter-example csv file

The counter-example is written as a CSV file. 

| Task ID |  Job ID |  r min |  r max | cost min | cost max | earliest start time |latest start time |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
|1	     |7	      |   60   |85	    |7	     |15	  |126	   |131     |
|1	     |6	     |50	   |60	    |4	     |16	  |110	   |115     |
|1	     |5	     |40	   |45	    |13	     |19	  |91	   |96      |
|1	     |4	     |30	   |80	    |10	     |15	  |76	   |81      |
|1	     |3		 |0	       |40	    |12	     |16	  |60	   |65      |
|1	     |2	     |0	       |30	    |15	     |20	  |40	   |45      |
|1	     |1	     |0	       |35	    |10	     |15	  |25	   |30      |

The deadline miss job for this job set is job J7. From this output file we see for J1 -> J2 -> J3 -> J4 -> J5 -> J6 -> J7 this job dispatching sequence, there may encounter a deadline miss execution scenario.
 
## License
IRIS group

